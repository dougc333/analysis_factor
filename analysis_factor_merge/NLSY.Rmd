---
title: "NLSY"
output: html_document
date: "2023-02-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Including Plots

You can also embed plots, for example:
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
library(psych)
library(tidyverse)
library(MASS)
library(ggplot2)
library(dplyr)
library(sqldf)
nlsy<-read.csv("/Users/dc/test_stuff/analysis_factor/datasets_irc_workshop/NLSY.csv")
```


```{r}
sapply(nlsy,class)
```

```{r}
colnames(nlsy)
```
Physical Health Composite Score  is PCS2000
plot y vs Xn. Continuous only
```{r}
#R0000100 ID, not data
#PCS2000 composite physical health score, Y, plot all Xn vs PCS2000
plot(nlsy$CESD2000Total, nlsy$PCS2000)
plot(nlsy$CESDTotal2000cutpt, nlsy$PCS2000)
plot(nlsy$MCS2000, nlsy$PCS2000)
plot(nlsy$RelAt2000cat6, nlsy$PCS2000)
plot(nlsy$RelAt2000cat2, nlsy$PCS2000)
plot(nlsy$NumberBioStepAdoptChildHH2000, nlsy$PCS2000)
plot(nlsy$BioChildHH2000c2, nlsy$PCS2000)
plot(nlsy$WorkTimeHrsperWkPastCalYr2000cat4, nlsy$PCS2000)
plot(nlsy$UnemplyWksPastCal2000c, nlsy$PCS2000)
plot(nlsy$UnemployedWksPastCal2000cont, nlsy$PCS2000)
plot(nlsy$IncomePercNetFam2000c, nlsy$PCS2000)
plot(nlsy$PovertyStatus2000c2, nlsy$PCS2000)
head(nlsy)
```
```{r}
#drop the R0000100 column. I dont know if this is a new view or release of memory
NLSY_drop_first_column = nlsy[,-1]
head(NLSY_drop_first_column)
#drop na
typeof(NLSY_drop_first_column)
class(NLSY_drop_first_column)
NLSY <- NLSY_drop_first_column %>% drop_na()

dim(NLSY_drop_first_column)
dim(NLSY)
head(NLSY)
#drop rows where there is a NA in any column. R should automatically drop these when doing regression? 
```


```{r}
#range PCS2000
get_range_and_mean <- function(df,col){
  #to print multiple lines need to use cat or print on top of sprintf
  cat(sprintf("min %s: %f \n",col,min(df[,col],na.rm=TRUE)))
  cat(sprintf("max %s: %f \n",col,max(df[,col],na.rm=TRUE)))
  cat(sprintf("mean %s: %f \n", col, mean(df[,col],na.rm = TRUE)))
}
get_range_and_mean(nlsy,"PCS2000")

#iterate through column names, 
for (i in colnames(NLSY)){
  print(i)
  get_range_and_mean(NLSY,i)
  print("-------------------") #no idea how this works, it prints the string with quotes!!
}

#centering, these are the 3 centered columns? 

NLSY$MCSCen<-NLSY$MCS2000-mean(NLSY$MCS2000,na.rm=TRUE)
NLSY$PCS2000Cen <- NLSY$PCS2000-mean(NLSY$PCS2000,na.rm=TRUE)
NLSY$CESD2000Cen =NLSY$CESD2000Total - mean(NLSY$CESD2000Total, na.rm=TRUE) #3.5 mean depression score, above 16 is clinically depressed

```



```{r}
plot(NLSY$MCS2000,NLSY$PCS2000,type="p",xlim=c(0,7000),ylab="Physical Health Composite Score",xlab="Mental Health Composite Score NonCentered)") 
abline(lm(NLSY$PCS2000 ~ NLSY$MCS2000),col="blue")
abline(v=0,col='blue') #add vertical line at 0
```
```{r}
model1<-lm(PCS2000~MCS2000,data=NLSY)
summary(model1)
```

```{r}
model2<-lm(PCS2000~MCSCen,data=NLSY)
summary(model2)
```

```{r}
plot(NLSY$MCSCen,NLSY$PCS2000,type="p",ylab="Physical Health Composite Score",xlab="Mental Health Composite Score Centered") 
abline(lm(NLSY$PCS2000 ~ NLSY$MCSCen),col='red')
abline(v=0,col='red') #add vertical line at 0
```
```{r}
##years of education 
mean(NLSY$Education2000) 
summary(lm(NLSY$PCS2000 ~ NLSY$Education2000))
```
```{r}
plot(NLSY$Education2000,NLSY$PCS2000,type="p",ylab="Physical Health Composite Score",xlab="Years of Education")
abline(lm(NLSY$PCS2000 ~ NLSY$Education2000)) #add regression line
abline(v=0,col='red') #add vertical line at 0
abline(v=12,col='red') #add vertical line at 12
abline(v=13.05,col='red') #add vertical line at the mean

```


```{r}
#Center Education
#EducCen centered at 12 not actual mean to make it equal to high school graduate
NLSY$EducCen<-NLSY$Education2000-12  #Center at 12
plot(NLSY$EducCen,NLSY$PCS2000,type="p",ylab="Physical Health Composite Score",xlab="Years of Education")
abline(lm(NLSY$PCS2000 ~ NLSY$EducCen),col="red") #add regression line
abline(v=0,col="red") #careful, centered line is 0 not 12. 
```

```{r}
summary(lm(NLSY$PCS2000 ~ NLSY$EducCen))
```




```{r}
#Depression Score
hist(NLSY$CESD2000Total, nclass=21)
```



```{r}
plot(NLSY$CESD2000Total,NLSY$PCS2000,type="p",ylab="Physical Health Composite Score",xlab="Depression Score 0-21 Center for Epi Study") 
abline(lm(NLSY$PCS2000 ~ NLSY$CESD2000Total)) #add regression line
abline(v=0,col='red') #add vertical line at 0
abline(v=3.5,col='red') #add vertical line at the mean 3.5
abline(v=16,col='red') #add vertical line at the clinical cutoff 16
NLSY$CESDCen<-NLSY$CESD2000Total-3.5 
```
```{r}
model3<-lm(PCS2000~Education2000+NumberBioStepAdoptChildHH2000+CESD2000Total+MCS2000,data=NLSY)
summary(model3)
```

```{r}
model4<-lm(PCS2000~EducCen+NumberBioStepAdoptChildHH2000+CESDCen+MCSCen,data=NLSY)
summary(model4)
```

```{r}
#colnames(nlsy[nlsy[c(11)]==0]) #NULL
#length(dplyr::filter(nlsy, Education2000==0)) length returns the 2nd dimension. Such a lousy interface

dim(dplyr::filter(nlsy, Education2000==0))
dim(dplyr::filter(nlsy, Education2000==1))
dim(dplyr::filter(nlsy, Education2000==2))
dim(dplyr::filter(nlsy, Education2000==3))
dim(dplyr::filter(nlsy, Education2000==4))
dim(dplyr::filter(nlsy, Education2000==5))
dim(dplyr::filter(nlsy, Education2000==6))
dim(dplyr::filter(nlsy, Education2000==7))
dim(dplyr::filter(nlsy, Education2000==8))
dim(dplyr::filter(nlsy, Education2000==9))
dim(dplyr::filter(nlsy, Education2000==10))
dim(dplyr::filter(nlsy, Education2000==11))
df_12 = dplyr::filter(nlsy, Education2000==12)
dim(dplyr::filter(nlsy, Education2000==12))
dim(dplyr::filter(nlsy, Education2000==13))
df_14 = (dplyr::filter(nlsy, Education2000==14))
dim(dplyr::filter(nlsy, Education2000==15))
dim(dplyr::filter(nlsy, Education2000==16))
dim(dplyr::filter(nlsy, Education2000==17))
dim(dplyr::filter(nlsy, Education2000==18))
dim(dplyr::filter(nlsy, Education2000==19))
dim(dplyr::filter(nlsy, Education2000==20))
dplyr::filter(nlsy, Education2000==14)
#how many data points are there to run regression? 
#-7 is 12-7=5 for EducCen, 0 is EducCen=0, +7 is EducCen=19

typeof(df_14) #list
class(df_14) #dataframe which one is correct?
dim(df_14) #plot these lines on CESD graph, want CESD2000 points and draw regression line for these points


```
```{r}
#this is incorrect. doesnt plot the 2 separate intercepts. Blue and red line are the same
plot(foo$CESDCen,foo$PCS2000,type="p",ylab="PCS2000",xlab="CESDSCen")
#how to draw the regression line
abline(lm(foo$PCS2000~foo$CESDCen),col="blue")
```
```{r}
df_12=dplyr::filter(foo, Education2000==12)
plot(df_12$CESDCen,df_12$PCS2000,type="p",ylab="PCS2000",xlab="CESDSCen")
#how to draw the regression line
lm_12 = lm(df_12$PCS2000~df_12$CESDCen)
abline(lm_12,col="blue")
summary(lm_12)
```
```{r}
df_16=dplyr::filter(foo, Education2000==16)
plot(df_16$CESDCen,df_16$PCS2000,type="p",ylab="PCS2000",xlab="CESDSCen")
#how to draw the regression line
lm_16 = lm(df_16$PCS2000~df_16$CESDCen)
#abline(lm_16,col="blue")
abline(lm_12,col="red")
summary(lm_16)
```
```{r}
#https://bookdown.org/dli/rguide/scatterplots-and-best-fit-lines-two-sets.html
#draw regression line on subset of df



```


```{r}
melanoma_male <- subset(Melanoma, sex == "1")
melanoma_female <- subset(Melanoma, sex == "0")
dim(melanoma_male)
dim(melanoma_female)
plot(Melanoma$age, Melanoma$time, 
     main = "Survival Time from Malignant Melanoma",
     xlab = "Age (in years)",
     ylab = "Survival Time (in days)",
     col = ifelse(Melanoma$sex == "1", "blue", "red"))
legend("topleft", 
       pch = c(1, 1), 
       c("Female", "Male"), 
       col = c("red", "blue")) 
abline(lm(melanoma_female$time ~ melanoma_female$age), col = "red")
abline(lm(melanoma_male$time ~ melanoma_male$age), col = "blue")
```
```{r}
#https://bookdown.org/dli/rguide/scatterplots-and-best-fit-lines-two-sets.html
#https://stackoverflow.com/questions/14860078/plot-multiple-lines-data-series-each-with-unique-color-in-r

plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==12), "blue", "red") )
```
```{r}
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==7), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==8), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==9), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==10), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==11), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==12), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==13), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==14), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==15), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==16), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==17), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==18), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==19), "blue", "red") )
plot(NLSY$CESD2000Cen,NLSY$PCS2000, col = ifelse(NLSY$EducCen == dplyr::filter(foo, Education2000==20), "blue", "red") )
```

